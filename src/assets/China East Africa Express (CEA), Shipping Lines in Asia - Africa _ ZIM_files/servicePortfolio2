function getContinentByCountry(n,t){var i="";return $(t).each(function(){var t=$(this).parent().find("ul li a");$(t).each(function(){if($(this).data("code")===n){var t=$(this).closest(".has-drop").find(".continent-office");n===$.cookie("country")&&($(t).parent().hasClass("active")||$(t).click(),$(this).parent().hasClass("active")||$(this).click());i=$(t).data("code")}})}),i}function arraysToLatLon(n){return n.map(function(n){return{lat:n[0],lon:n[1]}})}function buildRoadMultiple(n){var t=arraysToLatLon(n.coordinates);return{id:n.id,name:n.name,path:t}}var handler,portsLine,portCoordinates,countryTradeLine;L.GridLayer.GoogleMutant=L.GridLayer.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",opacity:1,continuousWorld:!1,noWrap:!1,type:"roadmap",maxNativeZoom:21},initialize:function(n){L.GridLayer.prototype.initialize.call(this,n);this._ready=!!window.google&&!!window.google.maps&&!!window.google.maps.Map;this._GAPIPromise=this._ready?Promise.resolve(window.google):new Promise(function(n,t){var i=0,r=setInterval(function(){if(i>=10)return clearInterval(r),t(new Error("window.google not found after 10 attempts"));if(!!window.google&&!!window.google.maps&&!!window.google.maps.Map)return clearInterval(r),n(window.google);i++},500)});this._tileCallbacks={};this._freshTiles={};this._imagesPerTile=this.options.type==="hybrid"?2:1},onAdd:function(n){L.GridLayer.prototype.onAdd.call(this,n);this._initMutantContainer();this._GAPIPromise.then(function(){this._ready=!0;this._map=n;this._initMutant();n.on("viewreset",this._reset,this);n.on("move",this._update,this);n.on("zoomend",this._handleZoomAnim,this);n.on("resize",this._resize,this);if(google.maps.event.addListenerOnce(this._mutant,"idle",function(){this._checkZoomLevels();this._mutantIsReady=!0}.bind(this)),n._controlCorners.bottomright.style.marginBottom="20px",n._controlCorners.bottomleft.style.marginBottom="20px",this._reset(),this._update(),this._subLayers)for(var t in this._subLayers)this._subLayers[t].setMap(this._mutant)}.bind(this))},onRemove:function(n){L.GridLayer.prototype.onRemove.call(this,n);n._container.removeChild(this._mutantContainer);this._mutantContainer=undefined;n.off("viewreset",this._reset,this);n.off("move",this._update,this);n.off("zoomend",this._handleZoomAnim,this);n.off("resize",this._resize,this);n._controlCorners.bottomright.style.marginBottom="0em";n._controlCorners.bottomleft.style.marginBottom="0em"},getAttribution:function(){return this.options.attribution},setOpacity:function(n){this.options.opacity=n;n<1&&L.DomUtil.setOpacity(this._mutantContainer,n)},setElementSize:function(n,t){n.style.width=t.x+"px";n.style.height=t.y+"px"},addGoogleLayer:function(n,t){return this._subLayers||(this._subLayers={}),this._GAPIPromise.then(function(){var r=google.maps[n],i=new r(t);return i.setMap(this._mutant),this._subLayers[n]=i,i}.bind(this))},removeGoogleLayer:function(n){var t=this._subLayers&&this._subLayers[n];t&&(t.setMap(null),delete this._subLayers[n])},_initMutantContainer:function(){this._mutantContainer||(this._mutantContainer=L.DomUtil.create("div","leaflet-google-mutant leaflet-top leaflet-left"),this._mutantContainer.id="_MutantContainer_"+L.Util.stamp(this._mutantContainer),this._mutantContainer.style.zIndex="800",this._mutantContainer.style.pointerEvents="none",this._map.getContainer().appendChild(this._mutantContainer));this.setOpacity(this.options.opacity);this.setElementSize(this._mutantContainer,this._map.getSize());this._attachObserver(this._mutantContainer)},_initMutant:function(){if(this._ready&&this._mutantContainer){this._mutantCenter=new google.maps.LatLng(0,0);var n=new google.maps.Map(this._mutantContainer,{center:this._mutantCenter,zoom:0,tilt:0,mapTypeId:this.options.type,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1,styles:this.options.styles||{},backgroundColor:"transparent"});this._mutant=n;google.maps.event.addListenerOnce(n,"idle",function(){for(var t=this._mutantContainer.querySelectorAll("a"),n=0;n<t.length;n++)t[n].style.pointerEvents="auto"}.bind(this));this.fire("spawned",{mapObject:n})}},_attachObserver:function(n){var t=new MutationObserver(this._onMutations.bind(this));t.observe(n,{childList:!0,subtree:!0})},_onMutations:function(n){for(var u,r,t,i=0;i<n.length;++i)for(u=n[i],r=0;r<u.addedNodes.length;++r)t=u.addedNodes[r],t instanceof HTMLImageElement?this._onMutatedImage(t):t instanceof HTMLElement&&Array.prototype.forEach.call(t.querySelectorAll("img"),this._onMutatedImage.bind(this))},_roadRegexp:/!1i(\d+)!2i(\d+)!3i(\d+)!/,_satRegexp:/x=(\d+)&y=(\d+)&z=(\d+)/,_staticRegExp:/StaticMapService\.GetMapImage/,_onMutatedImage:function(n){var u,t=n.src.match(this._roadRegexp),f=0,e,r,i,o,s;t?(u={z:t[1],x:t[2],y:t[3]},this._imagesPerTile>1&&(n.style.zIndex=1,f=1)):(t=n.src.match(this._satRegexp),t&&(u={x:t[1],y:t[2],z:t[3]}),f=0);u?(e=this._tileCoordsToKey(u),n.style.position="absolute",r=n.cloneNode(!0),r.style.visibility="visible",n.style.visibility="hidden",i=e+"/"+f,i in this._tileCallbacks&&this._tileCallbacks[i]?(this._tileCallbacks[i].shift()(r),this._tileCallbacks[i].length||delete this._tileCallbacks[i]):this._tiles[e]?(o=this._tiles[e].el,s=f===0?o.firstChild:o.firstChild.nextSibling,o.replaceChild(r,s)):i in this._freshTiles?this._freshTiles[i].push(r):this._freshTiles[i]=[r]):n.src.match(this._staticRegExp)&&(n.style.visibility="hidden")},createTile:function(n,t){var f=this._tileCoordsToKey(n),r=L.DomUtil.create("div"),u,i;for(r.dataset.pending=this._imagesPerTile,t=t.bind(this,null,r),u=0;u<this._imagesPerTile;u++)i=f+"/"+u,i in this._freshTiles?(r.appendChild(this._freshTiles[i].pop()),this._freshTiles[i].length||delete this._freshTiles[i],r.dataset.pending--):(this._tileCallbacks[i]=this._tileCallbacks[i]||[],this._tileCallbacks[i].push(function(n){return function(i){n.appendChild(i);n.dataset.pending--;parseInt(n.dataset.pending)||t()}.bind(this)}.bind(this)(r)));return parseInt(r.dataset.pending)||L.Util.requestAnimFrame(t),r},_checkZoomLevels:function(){var t=this._map.getZoom(),n=this._mutant.getZoom();t&&n&&(n!==t||n>this.options.maxNativeZoom)&&this._setMaxNativeZoom(n)},_setMaxNativeZoom:function(n){n!=this.options.maxNativeZoom&&(this.options.maxNativeZoom=n,this._resetView())},_reset:function(){this._initContainer()},_update:function(){var t,i;if(this._mutant){t=this._map.getCenter();i=new google.maps.LatLng(t.lat,t.lng);this._mutant.setCenter(i);var n=this._map.getZoom(),r=n!==Math.round(n),u=this._mutant.getZoom();r||n==u||(this._mutant.setZoom(n),this._mutantIsReady&&this._checkZoomLevels())}L.GridLayer.prototype._update.call(this)},_resize:function(){var n=this._map.getSize();(this._mutantContainer.style.width!==n.x||this._mutantContainer.style.height!==n.y)&&(this.setElementSize(this._mutantContainer,n),this._mutant)&&google.maps.event.trigger(this._mutant,"resize")},_handleZoomAnim:function(){if(this._mutant){var n=this._map.getCenter(),t=new google.maps.LatLng(n.lat,n.lng);this._mutant.setCenter(t);this._mutant.setZoom(Math.round(this._map.getZoom()))}},_removeTile:function(n){var i,u,f,s,e,t,r,o;if(this._mutant){for(i=0;i<this._imagesPerTile;i++)u=n+"/"+i,u in this._freshTiles&&delete this._freshTiles[u];if(f=this._mutant.getZoom(),s=n.split(":")[2],s==f&&f==this.options.maxNativeZoom&&(e=this._tiles[n].el.querySelectorAll("img"),e.length))for(t=0;t<this._imagesPerTile;t++)r=n+"/"+t,o=e[t],r in this._freshTiles?this._freshTiles[r].push(o):this._freshTiles[r]=[o];return L.GridLayer.prototype._removeTile.call(this,n)}}});L.gridLayer.googleMutant=function(n){return new L.GridLayer.GoogleMutant(n)},function(n){"use strict";function s(n,i){function r(n){return i.bgcolor&&(n.style.backgroundColor=i.bgcolor),i.width&&(n.style.width=i.width+"px"),i.height&&(n.style.height=i.height+"px"),i.style&&Object.keys(i.style).forEach(function(t){n.style[t]=i.style[t]}),n}return i=i||{},y(i),Promise.resolve(n).then(function(n){return h(n,i.filter,!0)}).then(p).then(w).then(r).then(function(r){return b(r,i.width||t.width(n),i.height||t.height(n))})}function c(n,i){return u(n,i||{}).then(function(i){return i.getContext("2d").getImageData(0,0,t.width(n),t.height(n)).data})}function l(n,t){return u(n,t||{}).then(function(n){return n.toDataURL()})}function a(n,t){return t=t||{},u(n,t).then(function(n){return n.toDataURL("image/jpeg",t.quality||1)})}function v(n,i){return u(n,i||{}).then(t.canvasToBlob)}function y(n){i.impl.options.imagePlaceholder=typeof n.imagePlaceholder=="undefined"?o.imagePlaceholder:n.imagePlaceholder;i.impl.options.cacheBust=typeof n.cacheBust=="undefined"?o.cacheBust:n.cacheBust}function u(n,i){function r(n){var r=document.createElement("canvas"),u;return r.width=i.width||t.width(n),r.height=i.height||t.height(n),i.bgcolor&&(u=r.getContext("2d"),u.fillStyle=i.bgcolor,u.fillRect(0,0,r.width,r.height)),r}return s(n,i).then(t.makeImage).then(t.delay(100)).then(function(t){var i=r(n);return i.getContext("2d").drawImage(t,0,0),i})}function h(n,i,r){function u(n){return n instanceof HTMLCanvasElement?t.makeImage(n.toDataURL()):n.cloneNode(!1)}function f(n,i,r){function f(n,t,i){var r=Promise.resolve();return t.forEach(function(t){r=r.then(function(){return h(t,i)}).then(function(t){t&&n.appendChild(t)})}),r}var u=n.childNodes;return u.length===0?Promise.resolve(i):f(i,t.asArray(u),r).then(function(){return i})}function e(n,i){function r(){function r(n,i){function r(n,i){t.asArray(n).forEach(function(t){i.setProperty(t,n.getPropertyValue(t),n.getPropertyPriority(t))})}n.cssText?i.cssText=n.cssText:r(n,i)}r(window.getComputedStyle(n),i.style)}function u(){function r(r){function s(n,i,r){function e(n){var t=n.getPropertyValue("content");return n.cssText+" content: "+t+";"}function o(n){function i(t){return t+": "+n.getPropertyValue(t)+(n.getPropertyPriority(t)?" !important":"")}return t.asArray(n).map(i).join("; ")+";"}var u="."+n+":"+i,f=r.cssText?e(r):o(r);return document.createTextNode(u+"{"+f+"}")}var e=window.getComputedStyle(n,r),o=e.getPropertyValue("content"),u,f;o!==""&&o!=="none"&&(u=t.uid(),i.className=i.className+" "+u,f=document.createElement("style"),f.appendChild(s(u,r,e)),i.appendChild(f))}[":before",":after"].forEach(function(n){r(n)})}function f(){n instanceof HTMLTextAreaElement&&(i.innerHTML=n.value);n instanceof HTMLInputElement&&i.setAttribute("value",n.value)}function e(){i instanceof SVGElement&&(i.setAttribute("xmlns","http://www.w3.org/2000/svg"),i instanceof SVGRectElement)&&["width","height"].forEach(function(n){var t=i.getAttribute(n);t&&i.style.setProperty(n,t)})}return(i instanceof Element)?Promise.resolve().then(r).then(u).then(f).then(e).then(function(){return i}):i}return!r&&i&&!i(n)?Promise.resolve():Promise.resolve(n).then(u).then(function(t){return f(n,t,i)}).then(function(t){return e(n,t)})}function p(n){return f.resolveAll().then(function(t){var i=document.createElement("style");return n.appendChild(i),i.appendChild(document.createTextNode(t)),n})}function w(n){return e.inlineAll(n).then(function(){return n})}function b(n,i,r){return Promise.resolve(n).then(function(n){return n.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(n)}).then(t.escapeXhtml).then(function(n){return'<foreignObject x="0" y="0" width="100%" height="100%">'+n+"<\/foreignObject>"}).then(function(n){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+i+'" height="'+r+'">'+n+"<\/svg>"}).then(function(n){return"data:image/svg+xml;charset=utf-8,"+n})}function k(){function r(){var n="application/font-woff",t="image/jpeg";return{woff:n,woff2:n,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:t,jpeg:t,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}function t(n){var t=/\.([^\.\/]*?)$/g.exec(n);return t?t[1]:""}function u(n){var i=t(n).toLowerCase();return r()[i]||""}function f(n){return n.search(/^(data:)/)!==-1}function e(n){return new Promise(function(t){for(var r=window.atob(n.toDataURL().split(",")[1]),u=r.length,f=new Uint8Array(u),i=0;i<u;i++)f[i]=r.charCodeAt(i);t(new Blob([f],{type:"image/png"}))})}function o(n){return n.toBlob?new Promise(function(t){n.toBlob(t)}):e(n)}function s(n,t){var i=document.implementation.createHTMLDocument(),u=i.createElement("base"),r;return i.head.appendChild(u),r=i.createElement("a"),i.body.appendChild(r),u.href=t,r.href=n,r.href}function h(){var n=0;return function(){function t(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}return"u"+t()+n++}}function c(n){return new Promise(function(t,i){var r=new Image;r.onload=function(){t(r)};r.onerror=i;r.src=n})}function l(n){var t=3e4;return i.impl.options.cacheBust&&(n+=(/\?/.test(n)?"&":"?")+(new Date).getTime()),new Promise(function(r){function s(){if(u.readyState===4){if(u.status!==200){f?r(f):o("cannot fetch resource: "+n+", status: "+u.status);return}var t=new FileReader;t.onloadend=function(){var n=t.result.split(/,/)[1];r(n)};t.readAsDataURL(u.response)}}function h(){f?r(f):o("timeout of "+t+"ms occured while fetching resource: "+n)}function o(n){console.error(n);r("")}var u=new XMLHttpRequest,f,e;u.onreadystatechange=s;u.ontimeout=h;u.responseType="blob";u.timeout=t;u.open("GET",n,!0);u.send();i.impl.options.imagePlaceholder&&(e=i.impl.options.imagePlaceholder.split(/,/),e&&e[1]&&(f=e[1]))})}function a(n,t){return"data:"+t+";base64,"+n}function v(n){return n.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}function y(n){return function(t){return new Promise(function(i){setTimeout(function(){i(t)},n)})}}function p(n){for(var i=[],r=n.length,t=0;t<r;t++)i.push(n[t]);return i}function w(n){return n.replace(/#/g,"%23").replace(/\n/g,"%0A")}function b(t){var i=n(t,"border-left-width"),r=n(t,"border-right-width");return t.scrollWidth+i+r}function k(t){var i=n(t,"border-top-width"),r=n(t,"border-bottom-width");return t.scrollHeight+i+r}function n(n,t){var i=window.getComputedStyle(n).getPropertyValue(t);return parseFloat(i.replace("px",""))}return{escape:v,parseExtension:t,mimeType:u,dataAsUrl:a,isDataUrl:f,canvasToBlob:o,resolveUrl:s,getAndEncode:l,uid:h(),delay:y,asArray:p,escapeXhtml:w,makeImage:c,width:b,height:k}}function d(){function i(t){return t.search(n)!==-1}function r(i){for(var r=[],u;(u=n.exec(i))!==null;)r.push(u[1]);return r.filter(function(n){return!t.isDataUrl(n)})}function u(n,i,r,u){function f(n){return new RegExp("(url\\(['\"]?)("+t.escape(n)+")(['\"]?\\))","g")}return Promise.resolve(i).then(function(n){return r?t.resolveUrl(n,r):n}).then(u||t.getAndEncode).then(function(n){return t.dataAsUrl(n,t.mimeType(i))}).then(function(t){return n.replace(f(i),"$1"+t+"$3")})}function f(n,t,f){function e(){return!i(n)}return e()?Promise.resolve(n):Promise.resolve(n).then(r).then(function(i){var r=Promise.resolve(n);return i.forEach(function(n){r=r.then(function(i){return u(i,n,t,f)})}),r})}var n=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:f,shouldProcess:i,impl:{readUrls:r,inline:u}}}function g(){function i(){return n(document).then(function(n){return Promise.all(n.map(function(n){return n.resolve()}))}).then(function(n){return n.join("\n")})}function n(){function n(n){return n.filter(function(n){return n.type===CSSRule.FONT_FACE_RULE}).filter(function(n){return r.shouldProcess(n.style.getPropertyValue("src"))})}function i(n){var i=[];return n.forEach(function(n){try{t.asArray(n.cssRules||[]).forEach(i.push.bind(i))}catch(r){console.log("Error while reading CSS rules from "+n.href,r.toString())}}),i}function u(n){return{resolve:function(){var t=(n.parentStyleSheet||{}).href;return r.inlineAll(n.cssText,t)},src:function(){return n.style.getPropertyValue("src")}}}return Promise.resolve(t.asArray(document.styleSheets)).then(i).then(n).then(function(n){return n.map(u)})}return{resolveAll:i,impl:{readAll:n}}}function nt(){function n(n){function i(i){return t.isDataUrl(n.src)?Promise.resolve():Promise.resolve(n.src).then(i||t.getAndEncode).then(function(i){return t.dataAsUrl(i,t.mimeType(n.src))}).then(function(t){return new Promise(function(i,r){n.onload=i;n.onerror=r;n.src=t})})}return{inline:i}}function i(u){function f(n){var t=n.style.getPropertyValue("background");return t?r.inlineAll(t).then(function(t){n.style.setProperty("background",t,n.style.getPropertyPriority("background"))}).then(function(){return n}):Promise.resolve(n)}return(u instanceof Element)?f(u).then(function(){return u instanceof HTMLImageElement?n(u).inline():Promise.all(t.asArray(u.childNodes).map(function(n){return i(n)}))}):Promise.resolve(u)}return{inlineAll:i,impl:{newImage:n}}}var t=k(),r=d(),f=g(),e=nt(),o={imagePlaceholder:undefined,cacheBust:!1},i={toSvg:s,toPng:l,toJpeg:a,toBlob:v,toPixelData:c,impl:{fontFaces:f,images:e,util:t,inliner:r,options:{}}};typeof module!="undefined"?module.exports=i:n.domtoimage=i}(this);handler={t:{},app:{},links:{},apiKeys:{bing:"AuhiCJHlGzhg93IqUH_oCpl_-ZUrIE6SPftlyGYUvr9Amx5nzA-WqGcPquyFZl4L",mapbox:"pk.eyJ1IjoidmFsZXJhLXRlc3QwMSIsImEiOiJjajFyb2ptOHcwMDBtMnFxcjVpdnEwcHBjIn0.L9qwQPcCoF_IqYR3RKYstA"},providersConfig:{Bing:["Road","Aerial","AerialWithLabels"],Google:["roadmap","satellite","terrain","hybrid"],OpenStreet:[],Mapbox:["streets","satellite","mapbox-terrain-v2","mapbox-streets-v7","mapbox-traffic-v1"]},initMap:function(){var n=$("html").attr("lang")==="he"?"bottomleft":"bottomright";return this.app.map=$(window).width()<769?L.map("map-id",{zoomControl:!1,minZoom:1}).setView([0,0],2):$("#map-id").parent().attr("id")==="schedule-map"?L.map("map-id",{zoomControl:!1,minZoom:2,zoom:3}).setView([0,0],3):L.map("map-id",{zoomControl:!1,minZoom:2}).setView([0,0],2),L.control.zoom({position:n}).addTo(this.app.map),this},initApp:function(){with(this){var isFirst=!0;app.layerController=new t.LayerController(app.map);$("#map-id, .navigation-tabs .sub-menu-open a, .leaflet-control-zoom-in, .leaflet-control-zoom-out, #schedule-map, .list.trades-navigation-list a").click(function(){if(isFirst){isFirst=!1;var coopirate="%C2%A9",mapboxUrl=$("html").data("mapProviderUrl"),mapboxTiles=L.tileLayer(mapboxUrl,{attribution:decodeURI(coopirate)+' <a href="https://www.mapbox.com/map-feedback/" target="_blank">Mapbox<\/a> '+decodeURI(coopirate)+' <a href="http://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap<\/a>'});app.layerController.setBaseLayer(mapboxTiles)}});app.mapController=new t.MapController(app.layerController,apiKeys);links.toOptionsWindowView=new t.BidirectionalReference;app.optionsWindowView=new t.OptionsWindowView(links.toOptionsWindowView,providersConfig);links.toOptionsWindowView["#from"]("optionsWindowView",app.optionsWindowView);app.mapTypeController=new t.MapTypeController(links.toOptionsWindowView,app.mapController);links.toOptionsWindowView["#from"]("mapTypeController",app.mapTypeController);app.providersController=new t.ProvidersController(providersConfig,app.mapController,app.mapTypeController,links.toOptionsWindowView);links.toOptionsWindowView["#resolve"]("providersController",app.providersController);app.curveService=new t.CurveService(t.Spline);app.officesService=new t.OfficesService;links.toOfficeView=new t.BidirectionalReference;links.toOfficeView["#from"]("layerController",app.layerController);app.officesView=new t.OfficesView(app.map,links.toOfficeView);app.officesController=new t.OfficesController(app.officesView,app.officesService,app.curveService,app.layerController);links.toOfficeView["#resolve"]("officesController",app.officesController);app.directionsService=new t.DirectionsService;links.toDirectionsView=new t.BidirectionalReference;links.toDirectionsView["#from"]("layerController",app.layerController);app.directionsView=new t.DirectionsView(app.map,links.toDirectionsView);app.directionsController=new t.DirectionsController(app.directionsView,app.directionsService,app.curveService,app.layerController);links.toDirectionsView["#resolve"]("directionsController",app.directionsController);app.portsService=new t.PortsService;links.toPortsView=new t.BidirectionalReference;links.toPortsView["#from"]("layerController",app.layerController);app.portsView=new t.PortsView(app.map,links.toPortsView);app.portsController=new t.PortsController(app.portsView,app.portsService,app.curveService,app.layerController);links.toPortsView["#resolve"]("portsController",app.portsController);app.countryTradeService=new t.CountryTradeService;links.toCountryTradeView=new t.BidirectionalReference;links.toCountryTradeView["#from"]("layerController",app.layerController);app.countryTradeView=new t.CountryTradeView(app.map,links.toCountryTradeView);app.countryTradeController=new t.CountryTradeController(app.countryTradeView,app.countryTradeService,app.curveService,app.layerController);links.toCountryTradeView["#resolve"]("countryTradeController",app.countryTradeController);app.scheduleLineService=new t.ScheduleLineService;links.toScheduleLineView=new t.BidirectionalReference;links.toScheduleLineView["#from"]("layerController",app.layerController);app.scheduleLineView=new t.ScheduleLineView(app.map,links.toScheduleLineView);app.scheduleLineController=new t.ScheduleLineController(app.scheduleLineView,app.scheduleLineService,app.curveService,app.layerController);links.toScheduleLineView["#resolve"]("scheduleLineController",app.scheduleLineController)}return this},buildUi:function(){with(this.app)optionsWindowView.build(map);return this},"#destroy":function(){}};window.onload=function(){var n=$("html").data("mapProvider");($(".schedule-by-line-map").length||$("#map-id").length)&&(handler.initMap().initApp().buildUi().app.providersController.setProvider(n),$(".schedule-by-line-map").length?handler.app.scheduleLineController.show():window.location.hash?window.location.hash==="#offices"?handler.app.officesController.showCountry():window.location.hash==="#services"?handler.app.directionsController.show():window.location.hash==="#ports"?handler.app.portsController.showWorld():window.location.hash==="#countryTrade"&&handler.app.countryTradeController.show():handler.app.directionsController.show(),$(handler).trigger("inited"))};$(function(){$(".trades-navigation-list").on("click",".trade-group",function(n){var t=$(this).attr("data-id");handler.app.directionsController.showPopup(t);n.preventDefault()});$(".trades-navigation-list").on("click",".trade-path",function(){var n=$(this).attr("data-id");return handler.app.directionsController.showPath(n),!1});$(".country-trades").on("click",".trade-country-path",function(){var n=$(this).attr("data-line-code");return handler.app.countryTradeController.showPath(n),!1});$(handler).on("inited",function(){$(handler.app.directionsController).on("onShowPopup",function(n,t){setTimeout(function(){var n=$(".trades-navigation-list li").has('a[data-id="{0}"]'.format(t));n.hasClass("active")||n.find(".opener").click()})});$(handler.app.countryTradeController).on("onShowPopup",function(n,t){setTimeout(function(){var n=$(".country-trades li").has('a[data-id="{0}"]'.format(t));n.hasClass("active")||n.find(".opener").click()})})})}),function(){$type=String;$type.__typeName="String";$type.__class=!0;$prototype=$type.prototype;$prototype.endsWith=function(n){return this.substr(this.length-n.length)===n};$prototype.startsWith=function(n){return this.substr(0,n.length)===n};$prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};$prototype.trimEnd=function(){return this.replace(/\s+$/,"")};$prototype.trimStart=function(){return this.replace(/^\s+/,"")};$prototype.format=function(){var n=Array.prototype.slice.call(arguments,0);return n.splice(0,0,this),String._toFormattedString(!1,n)};$type.format=function(){return String._toFormattedString(!1,arguments)};$type._toFormattedString=function(n,t){for(var e="",f=t[0],o,u,c,r,i=0;;){if(o=f.indexOf("{",i),u=f.indexOf("}",i),o<0&&u<0){e+=f.slice(i);break}if(u>0&&(u<o||o<0)){if(f.charAt(u+1)!=="}")throw new Error("format stringFormatBraceMismatch");e+=f.slice(i,u+1);i=u+2;continue}if(e+=f.slice(i,o),i=o+1,f.charAt(i)==="{"){e+="{";i++;continue}if(u<0)throw new Error("format stringFormatBraceMismatch");var s=f.substring(i,u),h=s.indexOf(":"),l=parseInt(h<0?s:s.substring(0,h),10)+1;if(isNaN(l))throw new Error("format stringFormatInvalid");c=h<0?"":s.substring(h+1);r=t[l];(typeof r=="undefined"||r===null)&&(r="");e+=r.toFormattedString?r.toFormattedString(c):n&&r.localeFormat?r.localeFormat(c):r.format?r.format(c):r.toString();i=u+1}return e}}(window);handler.t.Spline=function(n){var i,r,t;for(this.points=n.points||[],this.duration=n.duration||1e4,this.sharpness=n.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=n.stepLength||60,this.length=this.points.length,this.delay=0,t=0;t<this.length;t++)this.points[t].z=this.points[t].z||0;for(t=0;t<this.length-1;t++)i=this.points[t],r=this.points[t+1],this.centers.push({x:(i.x+r.x)/2,y:(i.y+r.y)/2,z:(i.z+r.z)/2});for(this.controls.push([this.points[0],this.points[0]]),t=0;t<this.centers.length-1;t++){var i=this.centers[t],r=this.centers[t+1],u=this.points[t+1].x-(this.centers[t].x+this.centers[t+1].x)/2,f=this.points[t+1].y-(this.centers[t].y+this.centers[t+1].y)/2,e=this.points[t+1].z-(this.centers[t].y+this.centers[t+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[t+1].x+this.sharpness*(this.centers[t].x+u),y:(1-this.sharpness)*this.points[t+1].y+this.sharpness*(this.centers[t].y+f),z:(1-this.sharpness)*this.points[t+1].z+this.sharpness*(this.centers[t].z+e)},{x:(1-this.sharpness)*this.points[t+1].x+this.sharpness*(this.centers[t+1].x+u),y:(1-this.sharpness)*this.points[t+1].y+this.sharpness*(this.centers[t+1].y+f),z:(1-this.sharpness)*this.points[t+1].z+this.sharpness*(this.centers[t+1].z+e)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this};handler.t.Spline.prototype.cacheSteps=function(n){var u=[],i=this.pos(0),r,t,f;for(u.push(0),r=0;r<this.duration;r+=10)t=this.pos(r),f=Math.sqrt((t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y)+(t.z-i.z)*(t.z-i.z)),f>n&&(u.push(r),i=t);return u};handler.t.Spline.prototype.vector=function(n){var t=this.pos(n+10),i=this.pos(n-10);return{angle:180*Math.atan2(t.y-i.y,t.x-i.x)/3.14,speed:Math.sqrt((i.x-t.x)*(i.x-t.x)+(i.y-t.y)*(i.y-t.y)+(i.z-t.z)*(i.z-t.z))}};handler.t.Spline.prototype.pos=function(n){function f(n,t,i,r,u){var e=function(n){var t=n*n,i=t*n;return[i,3*t*(1-n),3*n*(1-n)*(1-n),(1-n)*(1-n)*(1-n)]},f=e(n);return{x:u.x*f[0]+r.x*f[1]+i.x*f[2]+t.x*f[3],y:u.y*f[0]+r.y*f[1]+i.y*f[2]+t.y*f[3],z:u.z*f[0]+r.z*f[1]+i.z*f[2]+t.z*f[3]}}var i=n-this.delay,r,t,u;return(i<0&&(i=0),i>this.duration&&(i=this.duration-1),r=i/this.duration,r>=1)?this.points[this.length-1]:(t=Math.floor((this.points.length-1)*r),u=(this.length-1)*r-t,f(u,this.points[t],this.controls[t][1],this.controls[t+1][0],this.points[t+1]))};handler.t.CurveService=function(n){function t(n,t,r){var f=t.lat-n.lat,e=t.lon-n.lon,o=(n.lat+t.lat)/2,s=(n.lon+t.lon)/2,u=Math.sqrt(f*f+e*e),h=f/u,c=e/u,l=[n,{lat:o-c*r*u,lon:s+h*r*u},t];return i(l,u)}function i(t,i){for(var o={points:t.map(function(n){return{x:n.lat,y:n.lon}}),duration:i>0?Math.floor(i*1e3):1e3},e=new n(o),f=[],u,r=0;r<e.duration;r+=10){if(u=e.pos(r),isNaN(u.x)||isNaN(u.y))return f;Math.floor(r/100)%2==0&&f.push([u.x,u.y])}return f}this.arraysToLatLon=function(n){return n.map(function(n){return{lat:n[0],lon:n[1]}})};this.getCurvedPath=function(n){for(var r=[],f,i=0,u=n.length-1;i<u;i++)f=t(n[i],n[i+1],.1),r=r.concat(f);return n}};handler.t.LayerController=function(n){function r(){return i.layerControl||(i.layerControl=new L.Control.Layers(null,null,{position:"topright"}),i.layerControl.addTo(n)),i.layerControl}function u(n){var i=t[n];t[n]&&(r().removeLayer(i),i.remove(),delete t[n])}var t={pathLayer:null,pointsLayer:null},i={baseLayer:null,layerControl:null},f;this.viewContinents=function(t){n.on("zoom",function(){$(".sub-menu-open.active").children("a").attr("href")==="#offices"&&$(document.activeElement).attr("href")!=="#services"&&$(document.activeElement).attr("href")!=="#countryTrade"&&$(document.activeElement).attr("href")!=="#ports"&&n._zoom===$("html").data("maxZoom")&&(t(),n.off("zoom"))})};this.getMapInfo=function(){return n};$(".navigation-tabs .btn-close").click(function(){n.invalidateSize()});n.scrollWheelZoom.disable();n.on("click",function(){n.scrollWheelZoom.enabled()?n.scrollWheelZoom.disable():n.scrollWheelZoom.enable()});this.setMapSize=function(t){n.setMaxZoom(t)};this.setBaseLayer=function(t){if(!t)throw new Error("layer required");i.baseLayer&&n.removeLayer(i.baseLayer);i.baseLayer=t;n.addLayer(t)};this.prepareView=function(i){if(i==f)return!1;for(var r in t)u(r);return f=i,n.invalidateSize(!0),!0};this.setPointsLayer=function(i,f){u("pointsLayer");t.pointsLayer=i;r().addOverlay(i,"Points");i.addTo(n);f||n.fitBounds(i.getBounds())};this.setOfficesPointsLayer=function(i,f,e){if(u("pointsLayer"),t.pointsLayer=i,r().addOverlay(i,"Points"),i.addTo(n),!e&&f.length>0){var o=n.fitBounds(f);o._zoom>=10&&n.setZoom(8)}};this.setPathLayer=function(i,f){u("pathLayer");t.pathLayer=i;r().addOverlay(i,"Path");i.addTo(n);f||n.fitBounds(i.getBounds())};this.setTradesPathLayer=function(i,f){u("pathLayer");t.pathLayer=i;r().addOverlay(i,"Path");i.addTo(n);$(window).width()>1700&&n.setZoom(2);f||n.fitBounds(i.getBounds())}};handler.t.MapController=function(n,t){this.setOpenStreetMap=function(){var t="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png?layers=C",t="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png?layers=C",r,i;n:r='Map data © <a href="http://openstreetmap.org">OpenStreetMap<\/a> contributors';i=new L.TileLayer(t,{minZoom:2,maxZoom:12});n.setBaseLayer(i)};this.setBingMap=function(i){var r=L.tileLayer.bing({bingMapsKey:t.bing,imagerySet:i});n.setBaseLayer(r)};this.setGoogleMap=function(t){var i=new L.gridLayer.googleMutant({type:t});n.setBaseLayer(i)};this.setMapboxMap=function(t){var i,r;t=t||"streets";i="/images/map/{z}/{x}/{y}.png?v=7";window.location.hash==="#ports"?i=$("html").data("mapProviderUrl"):$(window).width()<769&&$("#map-id").parent().attr("id")==="schedule-map"&&(i=$("html").data("mapProviderUrl"));r=L.tileLayer(i,{attribution:'© <a href="http://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap<\/a>'});n.setBaseLayer(r)}};handler.t.ProvidersController=function(n,t,i){var r;this.setProvider=function(u){var f=n[u],e;if(!f)throw new Error("No such provider: "+u);r!=u&&(e="set"+u+"Map",t[e](f[0]),i.setOptions(e,f))}};handler.t.MapTypeController=function(n,t){var r,i;this.setOptions=function(t,u){var f=u.length>0;r=t;n.optionsWindowView.setTypeSelectVisibility(f);f&&(n.optionsWindowView.setTypeOptions(u),i=u[0])};this.selectOption=function(n){i!=n&&(i=n,t[r](n))}};handler.t.BidirectionalReference=function(){function i(t){if(t=="#promise"||t=="#resolve"||t=="#from")throw new Error("#promise, #resolve, #from is reserved names");if(n.indexOf(t)>-1)throw new Error("duplicated name: "+t);}var n=[],t;this["#from"]=function(t,r){i(t);this[t]=r;n.push(t)};this["#promise"]=new Promise(function(n){t=n});this["#resolve"]=function(r,u){i(r);var f=t;if(t=null,f==null)throw new Error("link resolved");this[r]=u;n.push(r);f(this)};this["#destroy"]=function(){for(var t in n)delete this[n[t]];delete n;delete this["#promise"];delete this["#resolve"]}};handler.t.OptionsWindowView=function(n,t){function f(t,i){return function(r){n[t][i](r.target.value)}}function e(){var n="",i;for(i in t)n+='<option value="{0}">{0}<\/option>'.format(i);return n}var r,i,u;this.build=function(n){var o=$("html").attr("lang")==="he"?"topleft":"topright",t=L.control({position:o});t.onAdd=function(){var n=L.DomUtil.create("div","options-window"),t;return n.innerHTML='<div class="fond"><\/div><div class="content">   select map provider:<br/>   <select>{0}<\/select>   <br/><hr/>   <div class="map-type">       select map type: <br/>       <select><\/select>   <\/div><\/div>'.format(e()),t=n.getElementsByTagName("select"),r=t[0],r.onchange=f("providersController","setProvider"),i=t[1],i.onchange=f("mapTypeController","selectOption"),u=n.getElementsByClassName("map-type")[0],n};t.addTo(n)};this.setTypeOptions=function(n){var t="",r;for(r in n)t+='<option value="{0}">{0}<\/option>'.format(n[r]);i.innerHTML=t};this.setTypeSelectVisibility=function(n){u.style.display=n?"":"none"}};var continentData={},citiesData=[],pathLine=[],officeInfo=[];handler.t.OfficesController=function(n,t,i,r){function u(){r.prepareView("offices.world");n.viewWorld(f())}function e(n){var t=!1,i;return function(r,u,f){return t?i:(t=!0,i=n(r,u,f))}}var f=e(t.getWorldData);this.showCountry=function(){r.prepareView("offices.country");t.getCountryData(t.getUserCountry());n.viewCountries(citiesData);r.viewContinents(u)};this.showContinent=function(i){r.prepareView("offices.continent");t.getCountryData(i);n.viewContinent(citiesData,i);r.viewContinents(u)};this.showCurrentCountry=function(t){r.prepareView("offices.country");switch(t){case"AZ":t="AJ";break;case"HR":t="CQ";break;case"EE":t="EN";break;case"DE":t="GE";break;case"GE":t="GO";break;case"LT":t="LN";break;case"ME":t="MB";break;case"UM":t="MI";break;case"PS":t="PX";break;case"TJ":t="TA";break;case"TL":t="TP";break;case"TM":t="TU";break;case"UZ":t="UB";break;case"RS":t="YU"}n.viewCurrentCountry(citiesData,t);r.viewContinents(u)};this.showPath=function(r){t.getPathOffice(r);var u=i.getCurvedPath(pathLine);n.showPath(pathLine,u)}};handler.t.OfficesView=function(n,t){function f(n){var i=$(".navigation-tabs").find(".subpanel.open");i&&$(i).find("a.btn-close").click();t.officesController.showContinent(n.data.continent)}function i(n){t.officesController.showCurrentCountry(n.data.countryCode)}function e(n,i){return function(){$(i).closest(".navigation-tabs").find(".subpanel.open").find("a.btn-close").click();$($(i).closest(".list").find(".has-drop")).each(function(){$(this).removeClass("active");$(this).find("ul").css("display","none")});$(i).parent().addClass("active");$(i).parent().find("ul").css("display","block");t.officesController.showContinent(n.code,i)}}function u(n,t,i){return function(){var u=n.getPopup(),r;u&&(r=L.DomUtil.create("div"),$.get("/umbraco/surface/ContactUs/GetAgencyInfo?countryCode="+t+"&agencyCode="+i,function(){}).done(function(t){t!==""&&($(t).each(function(n,t){var i=$("ul").find("[data-city='"+t.City+"']").attr("href");r.innerHTML='<div class="heading-box">{0}<\/div><div class="info-schedule"><a href="{1}">View Office Information<\/a><\/div><div><ul class="list-shipping lines-list-map"><\/li><li><b>Address<\/b> : {2}<\/li><li><b>Phone<\/b> : {3}<\/li><li><b>Fax<\/b> : {4}<\/li><\/ul><\/div>'.format(t.AgencyName,i,t.AgencyAddress,t.AgencyPhone,t.AgencyFax)}),n.bindPopup(r),setTimeout(function(){n.openPopup();var t=$(".notification-area").data("close");$(".leaflet-popup-close-button").attr("title",t)}))}))}}var o=L.icon({iconUrl:"/scripts/maps/img/PinShape_big.png",iconSize:[43,62],iconAnchor:[21,62]}),r=L.icon({iconUrl:"/scripts/maps/img/PinShape.png",iconSize:[17,22],iconAnchor:[8,22]});this.viewCountries=function(n){var s=[],h=L.featureGroup(n.map(function(n){var t=L.marker([n.lat,n.lon],{icon:r}),i;t.bindPopup();i=n.countryCode;i===$.cookie("country")&&s.push([n.lat,n.lon]);t.on("click",u(t,n.countryCodeCrm,n.code));return t.bindTooltip(""+n.name,{permanent:!0,direction:"bottom",className:"office-tooltip"}),t})),e,o;t.layerController.setOfficesPointsLayer(h,s);e=$(".continent-office");$(e).each(function(){$(this).unbind("click",f)});$(e).each(function(){$(this).bind("click",{continent:$(this).data("code")},f)});o=$(".continent-office").closest(".has-drop.active").find("ul li a");$(o).each(function(){$(this).unbind("click",i)});$(o).each(function(){$(this).bind("click",{countryCode:$(this).data("code")},i)});setTimeout(function(){$(".navigation-tabs .panel .scroll-vr").mCustomScrollbar("scrollTo",$(".contact-homepage-menu .has-panel.active"))},2e3)};this.viewContinent=function(n,f){var o=L.featureGroup(n.map(function(n){var t=L.marker([n.lat,n.lon],{icon:r}),i;t.bindPopup();i=n.code;t.on("click",u(t,n.countryCodeCrm,i));return t.bindTooltip(""+n.name,{permanent:!0,direction:"bottom",className:"office-tooltip"}),t})),e;t.layerController.setPathLayer(o);e=$(".continent-office."+f).parent().find("ul li a");$(e).each(function(){$(this).unbind("click",i)});$(e).each(function(){$(this).bind("click",{countryCode:$(this).data("code")},i)})};this.viewCurrentCountry=function(n,i){var f=[],e=L.featureGroup(n.map(function(n){var t=L.marker([n.lat,n.lon],{icon:r}),e;t.bindPopup();e=n.countryCode;e===i&&f.push([n.lat,n.lon]);t.on("click",u(t,n.countryCodeCrm,n.code));return t.bindTooltip(""+n.name,{permanent:!0,direction:"bottom",className:"office-tooltip"}),t}));t.layerController.setOfficesPointsLayer(e,f)};this.viewWorld=function(n){var i=$(".continent-office"),r=L.featureGroup(n.map(function(n){var r=L.marker([n.lat,n.lon],{title:n.count,icon:o}),t="";$(i).each(function(){$(this).data("code")===n.code&&(t=$(this))});r.on("click",e(n,t));if(jQuery._data($(t)[0],"events").click.length<=1)$(t).on("click",e(n,null));return r.bindTooltip(""+n.count,{permanent:!0,direction:"bottom",className:"office-tooltip"}).openTooltip(),r}));t.layerController.setPointsLayer(r)}};continentOfficeData=[];handler.t.OfficesService=function(){var n=$(".continent-office"),t;$(n).each(function(){continentOfficeData.push({count:$(this).data("count"),lat:$(this).data("lat"),lon:$(this).data("lon"),code:$(this).data("code")})});this.getWorldData=function(){return continentOfficeData};this.getUserCountry=function(){return getContinentByCountry($.cookie("country"),n)};this.getCurrentCountryByContinent=function(t){return getContinentByCountry(t,n)};this.getCountryData=function(n){continentData={};citiesData=[];$.ajax({url:"/umbraco/surface/ContactUs/GetCityByContinent?continentCode="+n,type:"get",async:!1,success:function(n){return $(n).each(function(t){n[t].AgencyLatitude>=-180&&n[t].AgencyLatitude<=180&&n[t].AgencyLongitude>=-180&&n[t].AgencyLongitude<=180&&citiesData.push({name:n[t].PortName,code:n[t].AgencyCode,lat:n[t].AgencyLatitude,lon:n[t].AgencyLongitude,countryCode:n[t].CountryCode,countryCodeCrm:n[t].CountryCodeCrm})}),continentData={continent:{view:{coordinates:[32.861132322810974,108.984375],zoom:5},cities:citiesData}}}})};this.getPathOffice=function(n){$.ajax({url:"/umbraco/surface/Trade/GetLineCoordinates?lineId="+n,type:"get",async:!1,success:function(n){return pathLine=[],$(n).each(function(t){pathLine.push({name:n[t].PortName,code:n[t].PortCode,lat:+n[t].Latitude,lon:+n[t].Longitude})}),pathLine}})};t={AF:{view:{coordinates:[32.861132322810974,108.984375],zoom:5},data:[{name:"Ningbo ^CNTMI",lat:29.53,lon:121.33},{name:"Chiwan ^CNCWQ",lat:22.28,lon:113.52}]},EU:{view:{coordinates:[-16.277960306212524,-49.394531250000007],zoom:5},data:[{name:"Itaguai ^BRIGD",lat:-22.52,lon:-43.46},{name:"Santos ^BREMB",lat:-23.55,lon:-46.19}]}}};portsLine=[];handler.t.PortsController=function(n,t,i,r){function f(n){var t=i.arraysToLatLon(n.coordinates);return{id:n.id,name:n.name,path:t}}function e(n){var t=!1,i;return function(r,u,f){return t?i:(t=!0,i=n(r,u,f))}}var u=e(t.getPortsData);this.showWorld=function(){r.prepareView("ports.world");r.setMapSize(10);n.viewWorld(u())};this.showPathPorts=function(i){var s=[],h=[],u=[],e=[],o=0,r,c,l,a,v,y;for(t.getPortPath(i),r=0;r<portsLine.length;r++)portsLine[r].dir===0?(c=parseFloat(portsLine[r].lat),l=parseFloat(portsLine[r].lon),s.push([c,l])):(a=parseFloat(portsLine[r].lat),v=parseFloat(portsLine[r].lon),h.push([a,v])),portsLine[r].sameLine==="True"&&(r!==0&&portsLine[r].index-1===o?(e.push([parseFloat(portsLine[r].lat),parseFloat(portsLine[r].lon)]),u.push({id:r+"_cross",name:r+"_cross",coordinates:e}),o=portsLine[r].index):(e=[],e.push([parseFloat(portsLine[r].lat),parseFloat(portsLine[r].lon)]),u.push({id:r+"_cross",name:r+"_cross",coordinates:e}),o=portsLine[r].index));u.push({id:"1",name:"1",coordinates:h});u.push({id:"0",name:"0",coordinates:s});y=u.reverse();n.showPathPorts(portsLine,y.map(f))}};handler.t.PortsView=function(n,t){function o(n,t,i){return function(){r(n,t,i);$(i).parent().hasClass("active")?n._openPopup(n):n.closePopup()}}function s(n){return function(){var t=$(n).closest("li");t.hasClass("active")||(t.addClass("active").children("ul").slideDown(300),t.siblings(".active").removeClass("active").children("ul").slideUp(300))}}function i(n,i,u,f){return function(e){return f&&t.portsController.showPathPorts(f),r(n,i,u),n.isPopupOpen()?($(e.target).find(".opener").length||$(e.target).hasClass("opener"))&&n.closePopup():n._openPopup(n),!1}}function h(n,t){return function(){var r=t.getPopup(),i;r||(i=L.DomUtil.create("div"),$.get("/umbraco/surface/ContactUs/GetMapLinesByPort?code="+n.code,function(){}).done(function(r){var u="";$(r).each(function(n,t){u+='<li class="direction-link" path-id="{0}">{1} ({0})<\/li>'.format(t.LineCode,t.LineName)});i.innerHTML='<div class="heading-box">{0}<\/div><div class="shipping-line"><b>Shipping Line by Port<\/b><\/div><div><ul class="list-shipping lines-list-map">{1}<\/ul><\/div>'.format(n.name,u);t.bindPopup(i);setTimeout(function(){t.openPopup();var n=$(".notification-area").data("close");$(".leaflet-popup-close-button").attr("title",n)})}))}}function r(n,i,r){var u=new Date,f=u.getDate(),e=u.getMonth()+1,s=u.getFullYear(),o,h;f<10&&(f="0"+f);e<10&&(e="0"+e);u=f+"-"+e+"-"+s;$(".leaflet-pane.leaflet-popup-pane").unbind();o="";$(i).each(function(){o+='<li class="direction-link" path-id="{0}">{1}<\/li>'.format($(this).data("lineCode"),$(this).text())});$(".leaflet-pane.leaflet-popup-pane").click(function(n){var i=n.target,r,u;if(i&&i.localName=="li"){for(u in i.attributes)i.attributes[u].name=="path-id"&&(r=i.attributes[u]);r&&t.portsController.showPathPorts(r.value)}});n._popup!==undefined&&(h=n._popup.setContent('<div class="heading-box">'+$(r).clone().children().remove().end().text()+'<\/div><div class="info-schedule"><a href="'+$(".contact-homepage-menu").data("schedulePort")+"?countrycode="+$(r).data("country")+"&portcode="+$(r).data("code")+"&datefrom="+u+'&weeksahead=6&direction=False">View Port Information & Schedule<\/a><\/div><div class="shipping-line"><b>Shipping Line by Port<\/b><\/div><div><ul class="list-shipping lines-list-map">'+o+"<\/ul><\/div>"))}var u=L.icon({iconUrl:"/scripts/maps/img/anchoreShape.png",iconSize:[17,21],iconAnchor:[0,0]}),f=L.icon({iconUrl:"/scripts/maps/img/anchoreShape.png",iconSize:[13,19],iconAnchor:[6,24],popupAnchor:[0,-24]}),e=L.icon({iconUrl:"/scripts/maps/img/anchoreShape.png",iconSize:[0,0],iconAnchor:[0,0],popupAnchor:[0,0]});this.viewWorld=function(n){var f=$(".port-map-info"),r="",e=L.featureGroup(n.map(function(n){var t=L.marker([n.lat,n.lon],{title:n.name,icon:u}),e="";if($(f).each(function(){$(this).data("code")===n.code&&(e=$(this));r=$(e).parent().find("ul li a");$(this).on("click",o(t,r,e))}),$(e).parent().find("ul li a").length){t.bindPopup();t.on("click",i(t,r,e));$(r).each(function(){$(this).on("click",i(t,r,e,$(this).data("lineCode")))});t.on("popupopen",s(e));t.on("popupclose",function(){if($(event.currentTarget).hasClass("leaflet-popup-close-button")){var n=$(e).closest("li");n.hasClass("active")&&n.removeClass("active").children("ul").slideUp(300)}})}return t.bindTooltip(""+n.name,{permanent:!0,direction:"bottom",className:"office-tooltip",offset:L.point(5,25)}).openTooltip(),t}));t.layerController.setPointsLayer(e)};this.showPathPorts=function(n,i){t.layerController.prepareView("offices.path");var r=L.featureGroup(i.map(function(n){return n.name.indexOf("_cross")>0?L.polyline(n.path,{className:"directions-bold-blue"}):n.name==="0"?L.polyline(n.path,{className:"directions-blue"}):L.polyline(n.path,{className:"directions-orange"})})),u=L.layerGroup(n.map(function(n){var t;if(n.name!==null){t=L.marker([n.lat,n.lon],{title:n.name,icon:f});t.bindTooltip(""+n.name,{permanent:!0,direction:"right",className:"office-tooltip",offset:L.point(5,-15)});t.on("click",h(n,t));return t}return L.marker([n.lat,n.lon],{title:"",icon:e})}));t.layerController.setPathLayer(r);t.layerController.setPointsLayer(u,!0)}};portsData=[];handler.t.PortsService=function(){var n=$(".port-map-info");$(n).each(function(){portsData.push({lat:$(this).data("lat"),lon:$(this).data("lon"),code:$(this).data("code"),name:$(this).data("name")})});this.getPortsData=function(){return portsData};this.getPortPath=function(n){$.ajax({url:"/umbraco/surface/Trade/GetLineCoordinates2?lineId="+n,type:"get",async:!1,success:function(n){return portsLine=[],$(n).each(function(t){portsLine.push({name:n[t].PortName,code:n[t].PortCode,lat:+n[t].Latitude,lon:+n[t].Longitude,dir:+n[t].RoadDirection,sameLine:"False",index:null});n[t].SameLine&&portsLine.push({name:null,code:null,lat:+n[t].Latitude,lon:+n[t].Longitude,dir:+n[t].RoadDirection,sameLine:"True",index:t})}),portsLine}})}};handler.t.DirectionsController=function(n,t,i,r){function u(n){var t=i.arraysToLatLon(n.coordinates);return{id:n.id,name:n.name,hidden:n.hidden,path:t}}this.show=function(){r.prepareView("directions");var i=t.getData();n.viewPaths(i.map(u))};this.showPopup=function(i,u){if(u==null||$(u).parent().hasClass("active")){$(this).trigger("onShowPopup",[i]);r.prepareView("directions")&&this.show();var f=t.getInfo(i);n.showDirectionsPopup(i,f)}else n.closeDirectionsPopup(i),r.prepareView("directions")&&this.show()};this.showPath=function(i,r){for(var c=[],l=[],o=[],s=[],h=0,e=t.getPath(i),a,v,y,p,w,f=0;f<e.length;f++)e[f].dir===0?(a=parseFloat(e[f].lat),v=parseFloat(e[f].lon),c.push([a,v])):(y=parseFloat(e[f].lat),p=parseFloat(e[f].lon),l.push([y,p])),e[f].sameLine==="True"&&(f!==0&&e[f].index-1===h?(s.push([parseFloat(e[f].lat),parseFloat(e[f].lon)]),o.push({id:f+"_cross",name:f+"_cross",coordinates:s}),h=e[f].index):(s=[],s.push([parseFloat(e[f].lat),parseFloat(e[f].lon)]),o.push({id:f+"_cross",name:f+"_cross",coordinates:s}),h=e[f].index));o.push({id:"1",name:"1",coordinates:l});o.push({id:"0",name:"0",coordinates:c});w=o.reverse();n.showPath(e,w.map(u),r)}};handler.t.DirectionsService=function(){var n=[],i={},t=[],r=$(".trade-group");$(r).each(function(){var i=[],t,e,r,f,u,o,s;if($(this).data("points").length)for(t=$(this),e=$(t).data("points").split("|"),r=0;r<e.length;r++){for(f=e[r].split(","),u=0;u<f.length;u+=2)o=parseFloat(f[u+1].replace("[","").replace("]","")),s=parseFloat(f[u].replace("[","").replace("]","")),i.push([o,s]);r===0?(n.push({id:$(t).data("id"),name:$(t).data("trade"),coordinates:i,hidden:"true",branch:"main"}),n.push({id:$(t).data("id"),name:$(t).data("trade"),coordinates:i,hidden:"false",branch:"main"}),i=[]):(n.push({id:$(t).data("id"),name:$(t).data("trade"),coordinates:i,hidden:"true",branch:"additional"}),n.push({id:$(t).data("id"),name:$(t).data("trade"),coordinates:i,hidden:"false",branch:"additional"}),i=[])}});this.getData=function(){return n};this.getInfo=function(n){return i[n]};this.getPath=function(n){return $.ajax({url:"/umbraco/surface/Trade/GetLineCoordinates2?lineId="+n,type:"get",async:!1,success:function(n){return t=[],$(n).each(function(i){t.push({name:n[i].PortName,code:n[i].PortCode,lat:+n[i].Latitude,lon:+n[i].Longitude,dir:+n[i].RoadDirection,sameLine:"False",index:null});n[i].SameLine&&t.push({name:null,code:null,lat:+n[i].Latitude,lon:+n[i].Longitude,dir:+n[i].RoadDirection,sameLine:"True",index:i})}),t}}),t};$(".trades-navigation-list > li").each(function(){var n=$(this),t=n.find(".trade-group");i[t.attr("data-id")]={name:t.data("trade"),paths:n.find("ul a").map(function(){var n=$(this);return{id:n.attr("data-id"),name:n.text()}}).toArray()}})};handler.t.DirectionsView=function(n,t){function r(n){return function(){var t=$(n).closest("li");t.hasClass("active")&&t.removeClass("active").children("ul").slideUp(300)}}function e(n,i){return function(){var r=new Date,u=r.getDate(),f=r.getMonth()+1,s=r.getFullYear(),o,e;u<10&&(u="0"+u);f<10&&(f="0"+f);r=u+"-"+f+"-"+s;o=i.getPopup();o||(e=L.DomUtil.create("div"),$.get("/umbraco/surface/ContactUs/GetMapLinesByPort?code="+n.code,function(){}).done(function(u){$(".leaflet-pane.leaflet-popup-pane").unbind();var f="";$(u).each(function(n,t){f+='<li class="direction-link" path-id="{0}">{1} ({0})<\/li>'.format(t.LineCode,t.LineName)});$(".leaflet-pane.leaflet-popup-pane").click(function(n){var i=n.target,r,u,f;if(i&&i.localName=="li"){for(u in i.attributes)i.attributes[u].name=="path-id"&&(r=i.attributes[u]);r&&(f=$(".trade-group.line-link").closest(".has-drop.active").find("ul li a.trade-path"),$(f).each(function(){$(this).parent().removeClass("active");$(this).data("id")===r.value&&$(this).parent().addClass("active")}),t.directionsController.showPath(r.value))}});e.innerHTML=('<div class="heading-box">{0}<\/div><div class="info-schedule"><a href="'+$(".contact-homepage-menu").data("schedulePort")+"?countrycode="+n.code.substring(0,2)+"&portcode="+n.code+"&datefrom="+r+'&weeksahead=6&direction=False">View Port Information & Schedule<\/a><\/div><div class="shipping-line"><b>Shipping Line by Port<\/b><\/div><div><ul class="list-shipping lines-list-map">{1}<\/ul><\/div>').format(n.name,f);i.bindPopup(e);setTimeout(function(){i.openPopup();var n=$(".notification-area").data("close");$(".leaflet-popup-close-button").attr("title",n)})}))}}var i={},u=L.icon({iconUrl:"/scripts/maps/img/anchoreShape.png",iconSize:[13,19],iconAnchor:[6,24],popupAnchor:[0,-24]}),f=L.icon({iconUrl:"/scripts/maps/img/anchoreShape.png",iconSize:[0,0],iconAnchor:[0,0],popupAnchor:[0,0]});this.viewPaths=function(n){var e=L.featureGroup(n.map(function(n){var o=$(".trade-group"),f="",u,e;if($(o).each(function(){$(this).data("id")===n.id&&(f=$(this))}),n.hidden==="false"){u=L.polyline(n.path,{className:"directions-hiden "+n.id});i[n.id]=u;u.bindTooltip(n.name,{direction:"top",className:"tooltip-inform"});f.on("click",function(){t.directionsController.showPopup(n.id,$(this));$(".leaflet-popup-close-button").on("click",r(f))});u.on("click",function(){t.directionsController.showPopup(n.id,null);$(".leaflet-popup-close-button").on("click",r(f))});return u}return e=L.polyline(n.path,{className:"directions-global"}),i[n.id]=e,e})),u,f;$(".list.trades-navigation-list .has-drop ul li.active").removeClass("active");t.layerController.setTradesPathLayer(e);u=$(".directions-hiden.leaflet-interactive");f=new MutationObserver(function(n){n.forEach(function(n){var t,i;n.attributeName==="class"&&($(n.target).hasClass("active")?(t=$(n.target).attr("class").replace(" active",""),$("path.leaflet-interactive").parent().find("path.leaflet-interactive").each(function(){$(this)!==$(n.target)&&$(this).attr("class")===t&&$("path.leaflet-interactive").eq($(this).index()-1).addClass("active")}),$("path.leaflet-interactive").eq($(n.target).index()-1).addClass("active")):(i=$(n.target).attr("class"),$("path.leaflet-interactive").parent().find("path.leaflet-interactive").each(function(){$(this)!==$(n.target)&&$(this).attr("class")===i&&$("path.leaflet-interactive").eq($(this).index()-1).removeClass("active")}),$("path.leaflet-interactive").eq($(n.target).index()-1).removeClass("active")))})});$(u).each(function(){f.observe($(this)[0],{attributes:!0})})};this.showDirectionsPopup=function(n,r){var f=i[n],u,e,o,s;if(f){if(u=f.getPopup(),!u){e=L.DomUtil.create("div");o=r.paths.map(function(n){return'<li class="direction-link" path-id="{0}">{1}<\/li>'.format(n.id,n.name)}).join("");e.innerHTML='<div class="heading-box"><h4>{0}<\/h4><\/div><ul class="lines-list-map">{1}<\/ul>'.format(r.name,o);e.addEventListener("click",function(n){var i=n.target,r,u,f;if(i&&i.localName=="li"){for(u in i.attributes)i.attributes[u].name=="path-id"&&(r=i.attributes[u]);r&&(f=$(".trade-group.line-link").closest(".has-drop.active").find("ul li a.trade-path"),$(f).each(function(){$(this).parent().removeClass("active");$(this).data("id")===r.value&&$(this).parent().addClass("active")}),t.directionsController.showPath(r.value,n))}});u=f.bindPopup(e,{className:"popup-information"});u.on("popupclose",function(){$(f.getElement()).removeClass("active");$("#map-id").removeClass("fade-directions")});u.on("popupopen",function(){$(f.getElement()).addClass("active");$("#map-id").addClass("fade-directions")});if(u.isPopupOpen()){u.closePopup();return}}f.openPopup();s=$(".notification-area").data("close");$(".leaflet-popup-close-button").attr("title",s)}};this.closeDirectionsPopup=function(n){var t=i[n],r;t&&(r=t.getPopup(),r._close())};this.showPath=function(n,i,r){var o,s,h;t.layerController.prepareView("directions.path");r!=undefined&&(o=r.target,$(o).hasClass("trade-path")&&($($(o).closest(".trades-navigation-list").find(".trade-path")).each(function(){$(this).parent().removeClass("active")}),$(o).parent().addClass("active")));s=L.featureGroup(i.map(function(n){return n.name.indexOf("_cross")>0?L.polyline(n.path,{className:"directions-bold-blue"}):n.name==="0"?L.polyline(n.path,{className:"directions-blue"}):L.polyline(n.path,{className:"directions-orange"})}));h=L.layerGroup(n.map(function(n){var t;if(n.name!==null){t=L.marker([n.lat,n.lon],{title:n.name,icon:u});t.bindTooltip(""+n.name,{permanent:!0,direction:"right",className:"office-tooltip",offset:L.point(5,-15)});t.on("click",e(n,t));return t}return L.marker([n.lat,n.lon],{title:"",icon:f})}));t.layerController.setPathLayer(s);t.layerController.setPointsLayer(h,!0)}};portCoordinates=[];handler.t.ScheduleLineController=function(n,t,i,r){if($(".schedule-by-line-map").length){t.getScheduleLinePath($(".schedule-by-line-map #map-id").data("line"));function u(n){var t=i.arraysToLatLon(n.coordinates);return{id:n.id,name:n.name,path:t}}this.show=function(){$("button.schedule-button-link, .map-block").click(function(){var o=[],s=[],i=[],f=[],e=0,t,h,c,l,a,v,y;for($(".schedule-by-line-map").css("display","block"),$.smoothScroll({scrollTarget:"#schedule-map"}),r.prepareView("scheduleLine"),t=0;t<portCoordinates.length;t++)portCoordinates[t].dir===0?(h=parseFloat(portCoordinates[t].lat),c=parseFloat(portCoordinates[t].lon),o.push([h,c])):(l=parseFloat(portCoordinates[t].lat),a=parseFloat(portCoordinates[t].lon),s.push([l,a])),portCoordinates[t].sameLine==="True"&&(t!==0&&portCoordinates[t].index-1===e?(f.push([parseFloat(portCoordinates[t].lat),parseFloat(portCoordinates[t].lon)]),i.push({id:t+"_cross",name:t+"_cross",coordinates:f}),e=portCoordinates[t].index):(f=[],f.push([parseFloat(portCoordinates[t].lat),parseFloat(portCoordinates[t].lon)]),i.push({id:t+"_cross",name:t+"_cross",coordinates:f}),e=portCoordinates[t].index));i.push({id:"1",name:"1",coordinates:s});i.push({id:"0",name:"0",coordinates:o});v=i.reverse();n.showPath(portCoordinates,v.map(u));y=r.getMapInfo();y._zoom>3&&$("#schedule-map").click()});$(".icon-close").click(function(){return $(".schedule-by-line-map").css("display","none"),!1})}}};handler.t.ScheduleLineService=function(){this.getScheduleLinePath=function(n){$.ajax({url:"/umbraco/surface/Trade/GetLineCoordinates2?lineId="+n,type:"get",async:!1,success:function(n){return portCoordinates=[],$(n).each(function(t){portCoordinates.push({name:n[t].PortName,code:n[t].PortCode,lat:+n[t].Latitude,lon:+n[t].Longitude,dir:+n[t].RoadDirection,sameLine:"False",index:null});n[t].SameLine&&portCoordinates.push({name:null,code:null,lat:+n[t].Latitude,lon:+n[t].Longitude,dir:+n[t].RoadDirection,sameLine:"True",index:t})}),portCoordinates}})}};handler.t.ScheduleLineView=function(n,t){function u(n,t){return function(){var r=t.getPopup(),i;r||(i=L.DomUtil.create("div"),$.get("/umbraco/surface/ContactUs/GetMapLinesByPort?code="+n.code,function(){}).done(function(r){$(".leaflet-pane.leaflet-popup-pane").unbind();var u="";$(r).each(function(n,t){u+='<li class="direction-link" path-id="{0}">{1} ({0})<\/li>'.format(t.LineCode,t.LineName)});i.innerHTML='<div class="heading-box">{0}<\/div><div class="shipping-line"><b>Shipping Line by Port<\/b><\/div><div><ul class="list-shipping lines-list-map">{1}<\/ul><\/div>'.format(n.name,u);t.bindPopup(i);setTimeout(function(){t.openPopup();var n=$(".notification-area").data("close");$(".leaflet-popup-close-button").attr("title",n)})}))}}var i=L.icon({iconUrl:"/scripts/maps/img/anchoreShape.png",iconSize:[13,19],iconAnchor:[6,24],popupAnchor:[0,-24]}),r=L.icon({iconUrl:"/scripts/maps/img/anchoreShape.png",iconSize:[0,0],iconAnchor:[0,0],popupAnchor:[0,0]});this.showPath=function(n,f){t.layerController.prepareView("schedule.path");var e=L.featureGroup(f.map(function(n){return n.name.indexOf("_cross")>0?L.polyline(n.path,{className:"directions-bold-blue"}):n.name==="0"?L.polyline(n.path,{className:"directions-blue"}):L.polyline(n.path,{className:"directions-orange"})})),o=L.layerGroup(n.map(function(n){var t;if(n.name!==null){t=L.marker([n.lat,n.lon],{title:n.name,icon:i});t.bindTooltip(""+n.name,{permanent:!0,direction:"right",className:"office-tooltip",offset:L.point(5,-15)});t.on("click",u(n,t));return t}return L.marker([n.lat,n.lon],{title:"",icon:r})}));t.layerController.setPathLayer(e);t.layerController.setPointsLayer(o,!0)}};countryTradeLine=[];handler.t.CountryTradeController=function(n,t,i,r){function u(n){var t=i.arraysToLatLon(n.coordinates);return{id:n.id,name:n.name,hidden:n.hidden,path:t}}this.show=function(){r.prepareView("countryTrade");var i=t.getData();n.viewPathsCountryTrades(i.map(u))};this.showPopupCountryTrade=function(i,u){if(u==null||$(u).parent().hasClass("active")){$(this).trigger("onShowPopup",[i]);r.prepareView("directions")&&this.show();var f=t.getInfoCountryTrade(i);n.showCountryTradePopup(i,f)}else r.prepareView("directions")&&this.show()};this.showPath=function(i){var s=[],h=[],f=[],e=[],o=0,r,c,l,a,v,y;for(t.getPathPort(i),r=0;r<countryTradeLine.length;r++)countryTradeLine[r].dir===0?(c=parseFloat(countryTradeLine[r].lat),l=parseFloat(countryTradeLine[r].lon),s.push([c,l])):(a=parseFloat(countryTradeLine[r].lat),v=parseFloat(countryTradeLine[r].lon),h.push([a,v])),countryTradeLine[r].sameLine==="True"&&(r!==0&&countryTradeLine[r].index-1===o?(e.push([parseFloat(countryTradeLine[r].lat),parseFloat(countryTradeLine[r].lon)]),f.push({id:r+"_cross",name:r+"_cross",coordinates:e}),o=countryTradeLine[r].index):(e=[],e.push([parseFloat(countryTradeLine[r].lat),parseFloat(countryTradeLine[r].lon)]),f.push({id:r+"_cross",name:r+"_cross",coordinates:e}),o=countryTradeLine[r].index));f.push({id:"1",name:"1",coordinates:h});f.push({id:"0",name:"0",coordinates:s});y=f.reverse();n.showPath(countryTradeLine,y.map(u))}};countryTradeData=[];handler.t.CountryTradeService=function(){var t={},r=$(".port-map-info"),n,i;$(r).each(function(){countryTradeData.push({lat:$(this).data("lat"),lon:$(this).data("lon"),code:$(this).data("code")})});this.getCountryTradeData=function(){return countryTradeData};n=[];i=$(".trade-country-group");$(i).each(function(){var r=[],t,e,u,f,i,o,s;if($(this).data("points").length)for(t=$(this),e=$(t).data("points").split("|"),u=0;u<e.length;u++){for(f=e[u].split(","),i=0;i<f.length;i+=2)o=parseFloat(f[i+1].replace("[","").replace("]","")),s=parseFloat(f[i].replace("[","").replace("]","")),r.push([o,s]);n.push({id:$(t).data("id"),name:$(t).data("trade"),coordinates:r,hidden:"true",branch:"main"});n.push({id:$(t).data("id"),name:$(t).data("trade"),coordinates:r,hidden:"false",branch:"main"});r=[]}});this.getData=function(){return n};this.getInfoCountryTrade=function(n){return t[n]};this.getPathPort=function(n){$.ajax({url:"/umbraco/surface/Trade/GetLineCoordinates2?lineId="+n,type:"get",async:!1,success:function(n){return countryTradeLine=[],$(n).each(function(t){countryTradeLine.push({name:n[t].PortName,code:n[t].PortCode,lat:+n[t].Latitude,lon:+n[t].Longitude,dir:+n[t].RoadDirection,sameLine:"False",index:null});n[t].SameLine&&countryTradeLine.push({name:null,code:null,lat:+n[t].Latitude,lon:+n[t].Longitude,dir:+n[t].RoadDirection,sameLine:"True",index:t})}),countryTradeLine}})};$(".list.country-trades > li").each(function(){var n=$(this),i=n.find(".trade-country-group");t[i.attr("data-id")]={name:i.data("trade"),paths:n.find("ul a").map(function(){var n=$(this);return{id:n.attr("data-line-code"),name:n.text()}}).toArray()}})};handler.t.CountryTradeView=function(n,t){function r(n){return function(){var t=$(n).closest("li");t.hasClass("active")&&t.removeClass("active").children("ul").slideUp(300)}}function e(n,i){return function(){var r=new Date,u=r.getDate(),f=r.getMonth()+1,s=r.getFullYear(),o,e;u<10&&(u="0"+u);f<10&&(f="0"+f);r=u+"-"+f+"-"+s;$(".leaflet-pane.leaflet-popup-pane").unbind();o=i.getPopup();o||(e=L.DomUtil.create("div"),$.get("/umbraco/surface/ContactUs/GetMapLinesByPort?code="+n.code,function(){}).done(function(u){var f="";$(u).each(function(n,t){f+='<li class="direction-link" path-id="{0}">{1} ({0})<\/li>'.format(t.LineCode,t.LineName)});e.innerHTML=('<div class="heading-box">{0}<\/div><div class="info-schedule"><a href="'+$(".contact-homepage-menu").data("schedulePort")+"?countrycode="+n.code.substring(0,2)+"&portcode="+n.code+"&datefrom="+r+'&weeksahead=6&direction=False">View Port Information & Schedule<\/a><\/div><div class="shipping-line"><b>Shipping Line by Port<\/b><\/div><div><ul class="list-shipping lines-list-map">{1}<\/ul><\/div>').format(n.name,f);i.bindPopup(e);$(".leaflet-pane.leaflet-popup-pane").click(function(n){var i=n.target,r,u;if(i&&i.localName=="li"){for(u in i.attributes)i.attributes[u].name=="path-id"&&(r=i.attributes[u]);r&&t.countryTradeController.showPath(r.value)}});setTimeout(function(){i.openPopup();var n=$(".notification-area").data("close");$(".leaflet-popup-close-button").attr("title",n)})}))}}var i={},u=L.icon({iconUrl:"/scripts/maps/img/anchoreShape.png",iconSize:[13,19],iconAnchor:[6,24],popupAnchor:[0,-24]}),f=L.icon({iconUrl:"/scripts/maps/img/anchoreShape.png",iconSize:[0,0],iconAnchor:[0,0],popupAnchor:[0,0]});this.viewPathsCountryTrades=function(n){var e=L.featureGroup(n.map(function(n){var o=$(".trade-country-group"),f="",u,e;if($(o).each(function(){$(this).data("id")===n.id&&(f=$(this))}),n.hidden==="false"){u=L.polyline(n.path,{className:"directions-hiden "+n.id});i[n.id]=u;u.bindTooltip(n.name,{direction:"top",className:"tooltip-inform"});f.on("click",function(){t.countryTradeController.showPopupCountryTrade(n.id,$(this));$(".leaflet-popup-close-button").on("click",r(f))});u.on("click",function(){t.countryTradeController.showPopupCountryTrade(n.id,null);$(".leaflet-popup-close-button").on("click",r(f))});return u}return e=L.polyline(n.path,{className:"directions-global"}),i[n.id]=e,e})),u,f;t.layerController.setPathLayer(e);u=$(".directions-hiden.leaflet-interactive");f=new MutationObserver(function(n){n.forEach(function(n){var t,i;n.attributeName==="class"&&($(n.target).hasClass("active")?(t=$(n.target).attr("class").replace(" active",""),$("path.leaflet-interactive").parent().find("path.leaflet-interactive").each(function(){$(this)!==$(n.target)&&$(this).attr("class")===t&&$("path.leaflet-interactive").eq($(this).index()-1).addClass("active")}),$("path.leaflet-interactive").eq($(n.target).index()-1).addClass("active")):(i=$(n.target).attr("class"),$("path.leaflet-interactive").parent().find("path.leaflet-interactive").each(function(){$(this)!==$(n.target)&&$(this).attr("class")===i&&$("path.leaflet-interactive").eq($(this).index()-1).removeClass("active")}),$("path.leaflet-interactive").eq($(n.target).index()-1).removeClass("active")))})});$(u).each(function(){f.observe($(this)[0],{attributes:!0})})};this.showCountryTradePopup=function(n,r){var f=i[n],u,e,o,s;if(f){if(u=f.getPopup(),!u){e=L.DomUtil.create("div");o=r.paths.map(function(n){return'<li class="direction-link" path-id="{0}">{1}<\/li>'.format(n.id,n.name)}).join("");e.innerHTML='<div class="heading-box"><h4>{0}<\/h4><\/div><ul class="lines-list-map">{1}<\/ul>'.format(r.name,o);e.addEventListener("click",function(n){var i=n.target,r,u;if(i&&i.localName=="li"){for(u in i.attributes)i.attributes[u].name=="path-id"&&(r=i.attributes[u]);r&&t.countryTradeController.showPath(r.value)}});u=f.bindPopup(e,{className:"popup-information"});u.on("popupclose",function(){$(f.getElement()).removeClass("active");$("#map-id").removeClass("fade-directions")});u.on("popupopen",function(){$(f.getElement()).addClass("active");$("#map-id").addClass("fade-directions")});if(u.isPopupOpen()){u.closePopup();return}}f.openPopup();s=$(".notification-area").data("close");$(".leaflet-popup-close-button").attr("title",s)}};this.showPath=function(n,i){t.layerController.prepareView("offices.path");var r=L.featureGroup(i.map(function(n){return n.name.indexOf("_cross")>0?L.polyline(n.path,{className:"directions-bold-blue"}):n.name==="0"?L.polyline(n.path,{className:"directions-blue"}):L.polyline(n.path,{className:"directions-orange"})})),o=L.layerGroup(n.map(function(n){var t;if(n.name!==null){t=L.marker([n.lat,n.lon],{title:n.name,icon:u});t.bindTooltip(""+n.name,{permanent:!0,direction:"right",className:"office-tooltip",offset:L.point(5,-15)});t.on("click",e(n,t));return t}return L.marker([n.lat,n.lon],{title:"",icon:f})}));t.layerController.setPathLayer(r);t.layerController.setPointsLayer(o,!0)}};$(document).ready(function(){var o=$("html").attr("lang")==="he"?"bottomleft":"bottomright",u="%C2%A9",i=[],r=$('.line-map-landing div[id^="map-id-"]'),f=2,s=L.icon({iconUrl:"/scripts/maps/img/anchoreShape.png",iconSize:[13,19],iconAnchor:[6,24],popupAnchor:[0,-24]}),h=L.icon({iconUrl:"/scripts/maps/img/anchoreShape.png",iconSize:[0,0],iconAnchor:[0,0],popupAnchor:[0,0]}),t;if($(window).width()<769&&(f=1),$(".line-map-landing").length)for(t=0;t<r.length;t++){var c=$(r[t]).data("line"),n=L.map($(r[t]).attr("id"),{zoomControl:!1}).setView([0,0],f),e=L.tileLayer("/images/map/{z}/{x}/{y}.png?v=7",{attribution:decodeURI(u)+' <a href="https://www.mapbox.com/map-feedback/" target="_blank">Mapbox<\/a> '+decodeURI(u)+' <a href="http://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap<\/a>'}).addTo(n);i.push({layer:e,id:$(r[t]).attr("id")});L.control.zoom({position:o}).addTo(n);n.scrollWheelZoom.disable();n.on("click",function(){$(this)[0].scrollWheelZoom._enabled?$(this)[0].scrollWheelZoom.disable():$(this)[0].scrollWheelZoom.enable()});$(".line-map-landing .leaflet-container").click(function(){for(var n=0;n<i.length;n++)i[n].id===$(this).attr("id")&&i[n].layer.setUrl($("html").data("mapProviderUrl"))});$.ajax({url:"/umbraco/surface/Trade/GetLineCoordinates2?lineId="+c,type:"get",async:!1,success:function(t){var r=[],i,v,y,p,w,b,o,k,d;$(t).each(function(n){r.push({name:t[n].PortName,code:t[n].PortCode,lat:+t[n].Latitude,lon:+t[n].Longitude,dir:+t[n].RoadDirection,sameLine:"False",index:null});t[n].SameLine&&r.push({name:null,code:null,lat:+t[n].Latitude,lon:+t[n].Longitude,dir:+t[n].RoadDirection,sameLine:"True",index:n})});var l=[],a=[],u=[],f=[],c=0;for(i=0;i<r.length;i++)r[i].dir===0?(v=parseFloat(r[i].lat),y=parseFloat(r[i].lon),l.push([v,y])):(p=parseFloat(r[i].lat),w=parseFloat(r[i].lon),a.push([p,w])),r[i].sameLine==="True"&&(i!==0&&r[i].index-1===c?(f.push([parseFloat(r[i].lat),parseFloat(r[i].lon)]),u.push({id:i+"_cross",name:i+"_cross",coordinates:f}),c=r[i].index):(f=[],f.push([parseFloat(r[i].lat),parseFloat(r[i].lon)]),u.push({id:i+"_cross",name:i+"_cross",coordinates:f}),c=r[i].index));u.push({id:"1",name:"1",coordinates:a});u.push({id:"0",name:"0",coordinates:l});b=u.reverse();o=L.featureGroup(b.map(buildRoadMultiple).map(function(n){return n.name.indexOf("_cross")>0?L.polyline(n,{className:"directions-bold-blue"}):n.name==="0"?L.polyline(n.path,{className:"directions-blue"}):L.polyline(n.path,{className:"directions-orange"})}));n.fitBounds(o.getBounds());k=n.getBoundsZoom(o.getBounds());k>=4&&e.setUrl($("html").data("mapProviderUrl"));o.addTo(n);d=L.layerGroup(r.map(function(n){var t;return n.name!==null?(t=L.marker([n.lat,n.lon],{title:n.name,icon:s}),t.bindTooltip(""+n.name,{permanent:!0,direction:"right",className:"office-tooltip",offset:L.point(5,-15)}),t):L.marker([n.lat,n.lon],{title:"",icon:h})}));d.addTo(n)}})}});$(document).ready(function(){function i(n){$(".subpanel").each(function(){$(this).hasClass("open")&&$(this).find(".btn-close").click()});n=="#offices"?handler.app.officesController.showCountry():n=="#services"?handler.app.directionsController.show():n=="#ports"?handler.app.portsController.showWorld():n=="#countryTrade"&&handler.app.countryTradeController.show()}var t=window.location.hash,n;t&&$('a[href="'+t+'"]').tab("show");$('.navigation-tabs a[data-toggle="tab"]').on("click",function(){var n=$(this).attr("href");window.location.hash=this.hash;i(n)});n=$("html").attr("lang")!=="he"?"left":"right";$(".map-section").parent().hasClass("tab-pane")&&$(".map-section").parent().css("margin-"+n,"340px");$(".navigation-tabs .sub-menu > .btn-close").click(function(){var t=$(this).closest("li");t.hasClass("sub-menu-open")?$(".map-section").parent().css("margin-"+n,"340px"):$(".map-section").parent().css("margin-"+n,"0")});$(".navigation-tabs li a[data-toggle='tab']").click(function(){$(this).parent().hasClass("sub-menu-open")?$(".map-section").parent().css("margin-"+n,"340px"):$(".map-section").parent().css("margin-"+n,"0")});$(".line-link").closest("li").find(".fa.fa-calendar").click(function(n){var t="";return t=$(this).parent().data("id")?$(this).parent().data("id"):$(this).parent().data("lineCode"),location.href=$(this).closest(".has-drop.active").find("a.line-link").data("url")+"&Line="+t,n.stopPropagation(),!1});$(".port-map-info").closest("li").find(".fa.fa-calendar").click(function(n){var t=$(this).parent().data("lineCode"),i=$(".sub-menu-open:first .sub-menu .trades-navigation-list").find(".trade-path");return $(i).each(function(){if($(this).data("id")===t)return location.href=$(this).closest(".has-drop").find("a.line-link").data("url")+"&Line="+t,!1}),n.stopPropagation(),!1});$("#map-download").click(function(){$(this).append('<i class="fa fa-spinner fa-spin"><\/i>');$(this).closest(".schedule-by-line-map").length?domtoimage.toJpeg(document.getElementById("schedule-map"),{quality:.95}).then(function(n){var t=document.createElement("a");t.download=$('*[data-id="tradeSelect"]').text()+" - "+$('*[data-id="lineSelect"]').text();t.href=n;t.click();$("#map-download").find(".fa.fa-spinner.fa-spin").remove()}):domtoimage.toJpeg(document.getElementById("map-homepage"),{quality:.95}).then(function(n){var t=document.createElement("a");t.download="map";t.href=n;t.click();$("#map-download").find(".fa.fa-spinner.fa-spin").remove()})})})